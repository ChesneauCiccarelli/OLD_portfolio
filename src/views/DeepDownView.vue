<template>
  <div class="relative">

    <div class="absolute left-[50%]">
      <div class="scrolling_rainbow">
        <div id="scrolling_rainbow-content">
          <div class="scrolling_rainbow-scroll z-[2]">
            <svg viewBox="0 0 24 24">
              <line class="st1" x1="12" y1="1" x2="12" y2="22.5" />
              <line class="st1" x1="12.1" y1="22.4" x2="18.9" y2="15.6" />
              <line class="st1" x1="11.9" y1="22.4" x2="5.1" y2="15.6" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <div class="z-1">
      <canvas id="project_title-canvas"></canvas>
    </div>

    <section class="project section_A mt-0">
      <div class="project_container">
        <div class="z-10">
          <h1>Deep Down Festival</h1>
          <h2>Branding a music festival</h2>
          <p>Get ready to dive deep into the world of electronic music with the DEEP DOWN Festival! Our three-day celebration is the ultimate tribute to the genre's biggest and best elements. By combining the two most beloved electronic genres - House and Chillout - we're bringing you an experience like no other.</p>
          <p class="project_subtitle">¿What is this project about?</p>
        </div>
        <div></div>
      </div>
    </section>

    <section class="project section_B">
      <div class="project_container">
        <div></div>
        <div class="z-10">
          <h1>The story</h1>
          <p>Our festival will be held in the beautiful city of Bordeaux. While the city has not previously hosted many festivals centered around electronic music, we want to explore the diverse world of electronic music as a whole. Transform everything for a unique and immersive experience. The beautiful outdoor setting of Bordeaux will provide the perfect backdrop for an unforgettable event.
          </p>
          <p class="project_subtitle">¿Making it plausible?</p>
        </div>
      </div>
    </section>

    <section class="project section_A">
      <div class="project_container">
        <div class="z-10">
          <h1>The name</h1>
          <p>The idea is to dive deep into the musical genre by going over everything that made up its universe. The name refers to this idea of re-discovering the history of the greatest advances in the dispersion of the electronic genre. It is here to evoke a sense of exploring the depths of one's emotions and connecting with the innermost aspects of oneself through music.</p>
          <p class="project_subtitle">¿Starting the journey?</p>
        </div>
          <div class="z-[1]">
            <img class="IMG_project" src="../../public/img/dd-sketches.png" alt="Logo Sketches">
          </div>
      </div>
    </section>

    <section class="section_C">
      <div class="section_C-content">
        <div class="section_C-1 z-10">
          <h1>An identity</h1>
          <p>For the creation of the festival's identity, simplicity was the key word. The shapes are very geometrical and leave room for the effect of emptiness in the centre of the logo, which is meant to recall the name of the festival with the effect of "falling". </p>
        </div>
        <div class="z-[1]]">
          <img src="../../public/img/dd-logosimple.png" alt="Différents logos du Deep Down Festival">
        </div>
        <div class="section_C-2 z-10">
          <h1>Simplicity</h1>
          <p>The shapes are very geometric and leave room for the effect of emptiness in the center. The black and white colors give way to a nostalgia as highlighted in our theme. The elegant white reinforces the impression of emptiness and the black offers a rather friendly and private feeling of intimacy.</p>
        </div>
      </div>
    </section>

    <section class="project section_B">
      <div class="project_container">
        <div></div>
        <div class="z-10">
          <h1>Strategy</h1>
          <p>A good project needs to be able to rely on accurate information research to define its target. It offers better understanding of customers' needs, wants, and preferences. Developing marketing messages and campaigns that resonate with their target audience and drive engagement is the way to succes. </p>
          <p class="project_subtitle">¿Focus on the users?</p>
        </div>
      </div>
    </section>

    <section class="project section_A">
      <div class="project_container">
        <div class="z-10">
          <h1>Colors</h1>
          <p>The black and white colours give way to a nostalgia as highlighted in our theme. The elegant white reinforces the impression of emptiness and the black offers a feeling of intimacy and privacy.</p>
          <p class="project_subtitle">¿Setting up the mood?</p>
        </div>
        <div class="z-[1]">
          <img class="IMG_project" src="../../public/img/dd-logos.png" alt="Déclinaison des logos">
        </div>
      </div>
    </section>

    <section class="project section_B">
      <div class="project_container">
        <div class="z-[1]">
          <img class="IMG_project" src="../../public/img/dd-affiche.png" alt="Exemple d'une affiche publicitaire">
        </div>
        <div class="z-10">
          <h1>Typography</h1>
          <p>The use of sans-serif typography promotes readability and comprehension while also providing a sense of neutrality and simplicity. It is important to carefully consider the placement and design of each element to ensure that the viewer can easily navigate and understand the information presented. By striking a balance between simplicity and contrast, we can create a visually appealing and effective design that effectively communicates its message to the intended audience.</p>
          <p class="project_subtitle">¿Layout and readability?</p>
        </div>
      </div>
    </section>

    <div class="section_D z-10 section_D--mobile">
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-vuejs.png" alt="Vue Js integration" />
          <div class="IMG_project-description">
            <h1>Vue Js</h1>
            <p>An open-source JavaScript framework used for building user interfaces and single-page applications</p>
          </div>
        </div>
      </div>
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-figma.png" alt="Figma Layout" />
          <div class="IMG_project-description">
            <h1>Layout model</h1>
            <p>Made entirely with Figma software (Design System, Layout, Prototyping)</p>
          </div>
        </div>
      </div>
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-mockup-affiche.jpg" alt="Use of Women's Work" />
          <div class="IMG_project-description">
            <h1>Mock up</h1>
            <p>Develop an identity on different media</p>
          </div>
        </div>
      </div>
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-backend.png" alt="Terms of reference of Women's Work" />
          <div class="IMG_project-description">
            <h1>Backend</h1>
            <p>Setting up a backend with firebase</p>
          </div>
        </div>
      </div>
    </div>

    <div id="wrap" class="section_D z-10 section_D--desktop">
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-vuejs.png" alt="Vue Js integration" />
          <div class="IMG_project-description">
            <h1>Vue Js</h1>
            <p>An open-source JavaScript framework used for building user interfaces and single-page applications</p>
          </div>
        </div>
      </div>
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-figma.png" alt="Figma Layout" />
          <div class="IMG_project-description">
            <h1>Layout model</h1>
            <p>Made entirely with Figma software (Design System, Layout, Prototyping)</p>
          </div>
        </div>
      </div>
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-mockup-affiche.jpg" alt="Use of Women's Work" />
          <div class="IMG_project-description">
            <h1>Mock up</h1>
            <p>Develop an identity on different media</p>
          </div>
        </div>
      </div>
      <div class="section_D-container">
        <div class="section_D-item">
          <img class="IMG_project z-[1]" src="../../public/img/dd-backend.png" alt="Terms of reference of Women's Work" />
          <div class="IMG_project-description">
            <h1>Backend</h1>
            <p>Setting up a backend with firebase</p>
          </div>
        </div>
      </div>
    </div>

    <section class="project section_A">
      <div class="project_container">
        <div class="z-10">
          <h1>The experience </h1>
          <p>This project was my first Vue Js project. It was carried out as part of an educational
            exercise at the <a class="underlinelink" href="#" target="_blank" rel="noopener noreferrer">MMI
              Montbéliard</a> department during my second semester of study. This project combines all the skills needed for this training: communication, design of a brand identity and website integration.</p>
          <p class="project_subtitle">¿Draw on its skills?</p>
        </div>
        <div></div>
      </div>
    </section>

    <section class="project section_B">
      <div class="project_container">
        <div></div>
        <div class="z-10">
          <h1>Feedback</h1>
          <p>This experience has allowed me to develop new skills but also to strengthen others. I was able to improve my approach to web design and integration by discovering new technologies such as VueJs, Tailwind, Firebase and strengthen my skills with Figma in creating components and layouts.</p>
          <p class="project_subtitle">¿what I learnt from it?</p>
        </div>
      </div>
    </section>

    <div>
      <a class="BTN_glitch faded z-10" href="https://deepdown.lilianchesneau.com/" target="_blank">Take a look of the
        product</a>
    </div>

    <div class="m-auto text-center mt-[10rem]">
      <RouterLink to="/">
        <button class="m-auto z-10">
          <span>Other projects</span>
          <div class="BTN_liquid"></div>
        </button>
      </RouterLink>
    </div>

    <p class="credits z-0">Deep Down Festival<br />Lilian Chesneau</p>
  </div>
</template>

<script>
import project from "../components/Projets.vue"
import { gsap } from "gsap";
import * as THREE from 'three';
import "https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"
import $ from "jquery";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import 'https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js';

export default {
  components: {
    project,
  },
  mounted() {

    /* ===== Scrolling Rainbow ===== */
    gsap.registerPlugin(ScrollTrigger);
    const content = document.querySelector('#scrolling_rainbow-content');

    /* ===== Noise ===== */
    const simplex = new SimplexNoise();

    const tailleMax = $('html').height();
    const numero = tailleMax + (tailleMax / 5.3);

    for (let i = 0; i < numero; i++) {
      // créer un nouveau cercle
      const div = document.createElement('div');
      div.classList.add('circle');
      // générer les valeurs de bruit pour les transformations CSS
      const n1 = simplex.noise2D(i * 0.003, i * 0.0033);
      const n2 = simplex.noise2D(i * 0.002, i * 0.001);
      // définir les styles CSS
      const style = {
        transform: `translate(${n2 * 100}px) rotate(${n2 * 270}deg) scale(${3 + n1 * 2}, ${3 + n2 * 2})`,
        boxShadow: `0 0 0 .2px hsla(${Math.floor(i * 0.3)}, 70%, 70%, .6)`
      };
      Object.assign(div.style, style);
      // ajouter le cercle au conteneur
      content.appendChild(div);
      // vérifier si le conteneur est plein
      if (content.children.length === numero) {
        break; // arrêter la boucle
      }
    }
    const Circles = document.querySelectorAll('.circle');
    const main = gsap.timeline({
      scrollTrigger: {
        scrub: .7,
        start: "top 40%",
        end: "bottom bottom"
      }
    });
    Circles.forEach(circle => {
      main.to(circle, {
        opacity: 1
      });
    });



    /* ===== Project Title Animation ===== */
    // load webfont from Google Fonts
    WebFont.load({
      google: {
        families: ['Major Mono Display']
      },

      classes: false,
      active: () => {
        createCanvas();
        updateCanvas();
      }
    });
    // vertex shader
    const vertexShader = `
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform float time;
    uniform float index;
    uniform float divisions;
    uniform float tOffsetX;
    uniform vec4 tween;
    attribute vec3 position;
    attribute vec2 uv;
    varying vec2 vUv;

    mat2 scale2D(vec2 scale) {
    return mat2(scale.x, 0.0, 0.0, scale.y);
    }

    void main() {
    vUv = uv;
    vec3 pos = position;

    float scaleX = tween.x;
    pos.x += tOffsetX;
    pos.xy *= scale2D(vec2(scaleX, 1.0));
    pos.x -= tOffsetX;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
    }
    `;
    // fragment shader
    const fragmentShader = `
    precision highp float;

    uniform sampler2D texture;
    uniform float time;
    uniform float index;
    uniform float divisions;
    uniform vec4 tween;
    varying vec2 vUv;

    void main() {
    vec2 uv = vUv;
    float startV = index * (1.0 / divisions);
    vec2 tuv = vec2(uv.x, startV + uv.y * (1.0 / divisions));

    vec4 color = texture2D(texture, tuv);

    gl_FragColor = color;
    //gl_FragColor = vec4(vec3(tuv.y), 1.0);
    }
    `;
    // general settings
    const width = window.innerWidth;
    const height = window.innerHeight;
    const aspectRatio = width / height;
    const dpr = Math.min(window.devicePixelRatio, 2);
    const sceneWidth = 2;
    const sceneHeight = sceneWidth / aspectRatio;
    let scene, camera, renderer;
    // title settings
    const titleWidth = 2.0;
    const titleHeight = 0.5;
    const numDivisions = 40;
    const titleMeshes = [];
    let numMeshes = 0;
    // animation settings
    const tweens1 = []; // array of tweens for title1
    const tweens2 = []; // array of tweens for title2
    const tweens3 = []; // array of tweens for title3

    function createCanvas() {
      scene = new THREE.Scene();
      camera = new THREE.OrthographicCamera(
        -sceneWidth / 2, sceneWidth / 2, sceneHeight / 2, -sceneHeight / 2, 0.01, 1000
      );
      camera.position.set(0, 0, 1);

      renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true,
        canvas: document.getElementById('project_title-canvas')
      }
      );
      renderer.setSize(width, height);
      renderer.setPixelRatio(dpr);

      const texture1 = createFontTexture({
        width: 1024,
        height: 256,
        fontSize: 80,
        text: "discover"
      });

      const texture2 = createFontTexture({
        width: 1024,
        height: 256,
        fontSize: 80,
        text: "deep down"
      });

      const texture3 = createFontTexture({
        width: 1024,
        height: 256,
        fontSize: 80,
        text: 'festival'
      });

      createTitle({
        texture: texture1,
        tweens: tweens1
      });

      createTitle({
        texture: texture2,
        tweens: tweens2
      });

      createTitle({
        texture: texture3,
        tweens: tweens3
      });

      numMeshes = titleMeshes.length;

      animateTitle();
    }

    function createFontTexture(options) {
      const canvas = document.createElement('canvas');
      const width = options.width * dpr;
      const height = options.height * dpr;
      canvas.width = width;
      canvas.height = height;

      const ctx = canvas.getContext('2d');

      ctx.font = `400 ${options.fontSize * dpr}px 'Major Mono Display'`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#F5F5F5';
      ctx.fillText(options.text, width / 2, height / 2 + 25);

      const texture = new THREE.CanvasTexture(canvas);
      texture.minFilter = THREE.LinearFilter;
      texture.magFilter = THREE.LinearFilter;
      texture.format = THREE.RGBAFormat;
      texture.needsUpdate = false;

      return texture;
    }

    function createTitle(params) {
      for (let i = 0; i < numDivisions; i++) {
        const dividedHeight = titleHeight / numDivisions;
        const geometry = new THREE.PlaneGeometry(titleWidth, dividedHeight);

        const material = new THREE.RawShaderMaterial({
          uniforms: {
            texture: { value: params.texture },
            time: { value: 0 },
            index: { value: i },
            divisions: { value: numDivisions },
            tOffsetX: { value: -1.0 },
            tween: { value: new THREE.Vector4(0, 0, 1, 1) }
          },

          vertexShader,
          fragmentShader,
          transparent: true
        });

        const y = -titleHeight * 0.5 + i * dividedHeight + dividedHeight * 0.5;

        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.y = y;

        scene.add(mesh);
        titleMeshes.push(mesh);
        params.tweens.push(material.uniforms.tween.value);
      }
    }

    function animateTitle() {
      const tl = gsap.timeline({
        repeat: -1,
        defaults: {
          ease: "power3.inOut",
          duration: 0.8,
          stagger: 0.01
        }
      });

      const setTransformOffset = (titleIndex, value) => {
        const startIndex = titleIndex * numDivisions;
        const endIndex = startIndex + numDivisions;
        for (let i = startIndex; i < endIndex; i++) {
          titleMeshes[i].material.uniforms.tOffsetX.value = value;
        }
      };

      tl.to(tweens1, {
        x: 1.0,
        onStart: () => {
          setTransformOffset(0, -1.0);
        }
      },
        'start');
      tl.to(tweens1, {
        x: 0.0,
        onStart: () => {
          setTransformOffset(0, 1.0);
        }
      },
        'next1');
      tl.to(tweens2, {
        x: 1.0,
        onStart: () => {
          setTransformOffset(1, -1.0);
        }
      },
        'next1');
      tl.to(tweens2, {
        x: 0.0,
        onStart: () => {
          setTransformOffset(1, 1.0);
        }
      },
        'next2');
      tl.to(tweens3, {
        x: 1.0,
        onStart: () => {
          setTransformOffset(2, -1.0);
        }
      },
        'next2');
      tl.to(tweens3, {
        x: 0.0,
        onStart: () => {
          setTransformOffset(2, 1.0);
        }
      });
    }

    function updateCanvas() {
      requestAnimationFrame(updateCanvas);
      const time = performance.now() * 0.001;
      for (let i = 0; i < numMeshes; i++) {
        const mesh = titleMeshes[i];
        mesh.material.uniforms.time.value = time;
      }
      renderer.render(scene, camera);
    }

    $(document).ready(function () {
      var docWidth = $('body').width(),
        $wrap = $('#wrap'),
        $images = $('#wrap .section_D-container'),
        slidesWidth = $wrap.width();

      $(window).on('resize', function () {
        docWidth = $('body').width();
        slidesWidth = $wrap.width();
      })

      $(document).mousemove(function (e) {
        var mouseX = e.pageX,
          offset = mouseX / docWidth * slidesWidth - mouseX / 2;

        $images.css({
          '-webkit-transform': 'translate3d(' + -offset + 'px,0,0)',
          'transform': 'translate3d(' + -offset + 'px,0,0)'
        });
      });
    })
  }
} 
</script>

<style>
/* ===== Tailwind Modif ===== */
.z-10 {
  position: relative;
}

/* ===== Scrolling Rainbow ===== */
div.scrolling_rainbow {
  margin-top: 19px;
  position: relative;
}

.scrolling_rainbow-scroll {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
}

.circle {
  width: 20px;
  height: 20px;
  border-radius: 40%;
  opacity: 0;
  margin: -19px auto;
  transition: transform 1s cubic-bezier(0.14, 0.15, 0.13, 0.99);
}

/* ===== Project ===== */
.project {
  max-width: 1300px;
  margin: 0 auto;
  padding: 0 8% 0 8%;
}

.section_A {
  max-width: 100%;
  margin: 20rem 0 20rem 0;
  border-bottom: 1px solid var(--light-gray);
}

.section_A h2 {
  font-size: var(--l);
  margin-bottom: 2rem;
}

p.project_subtitle {
  font-family: var(--display);
  font-size: var(--l);
  margin: 1rem 0 2rem 2rem;
  text-transform: lowercase;
  text-decoration: overline;
}

.section_B {
  text-align: right;
  margin: 20rem 0 20rem 0;
}

.section_B p.project_subtitle {
  margin: 1rem 2rem 2rem 0;
}

.section_C {
  margin: 20rem 0 20rem 0;
  padding: 0 8% 0 8%;
}

.section_C-content {
  display: flex;
  flex-direction: column;
  gap: 10rem;
}

.section_C-1 {
  text-align: left;
}

.section_C-2 {
  text-align: right;
}

.section_D {
  margin: 20rem 0 20rem 0;
  padding: 0 8% 0 8%;
  display: flex;
  flex-direction: column;
  gap: 10rem;
}

.section_D--mobile {
  display: flex;
}

.section_D--desktop {
  display: none;
}

.credits {
  display: none;
}

/* ===== Project Media ===== */
img.IMG_project {
  border: 1px solid var(--light);
  border-radius: 20px;
  padding: 1rem;
}

#wrap img {
  object-fit: contain;
}



/* ===== Tablet ===== */
@media only screen and (min-width: 768px) {

  /* ===== Project ===== */
  .project {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 8% 0 8%;
  }

  .section_A .project_container,
  .section_B .project_container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 3rem;
    align-items: center;
    justify-content: center;
    margin: 15rem 0 15rem 0;
  }

  .section_B {
    text-align: right;
  }

  .section_D {
    margin: 0;
    padding: 0;
  }

  .section_D-container {
    position: relative;
    width: 25%;
    z-index: 1;
    display: flex;
    align-items: center;
    z-index: 2;
    transform: scale(.97);
  }

  .section_D-item {
    position: relative;
    display: block;
    max-width: 90%;
  }

  .section_D-item img {
    position: relative;
    display: block;
    width: 100%;
    height: auto;
    z-index: 2;
  }

  .section_D--mobile {
    display: none;
  }

  .section_D--desktop {
    display: flex;
  }

  #wrap {
    left: 0;
    top: 0;
    width: 150%;
    height: 100%;
    display: flex;
    flex-direction: row;
    align-items: stretch;
    margin: 20rem 25%;
    gap: 0;
  }

  .section_D-container:hover .IMG_project-description {
    opacity: 1;
    transform: scaleY(1) translateY(0);
  }

  .credits {
    display: block;
    position: fixed;
    bottom: 0;
    right: 0;
    padding: 1.5em;
    font-size: .8em;
    text-align: right;
    opacity: .6;
    transition: opacity .2;
    z-index: 3;
  }

  .credits:hover {
    text-decoration: underline;
    opacity: 1;
  }

  /* ===== Project Media ===== */
  .IMG_project-description {
    position: absolute;
    top: 100%;
    left: 10%;
    width: 80%;
    opacity: 0;
    padding: 1em 0 0 1em;
    border-left: 1px solid;
    z-index: 1;
    transform: scaleY(1) translateY(-50px);
    transition: transform .2s, opacity .5s;
  }



  /* ===== Desktop ===== */
  @media only screen and (min-width: 1025px) {

    .section_C {
      height: 100%;
      padding: 0;
    }

    .section_C .section_C-content {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-gap: 50px;
      margin: 10rem auto 20rem auto;
      padding: 0 8% 0 8%;
      text-align: center;
      place-items: center;
    }
  }
}
</style>